上节笔记中的 initData 函数，还剩最后一段代码：

``` javascript
// observe data
observe(data, true /* asRootData */)
```

这就是响应式系统的开始，不过在开始前，我们需要先明白，什么是响应式？社么是观察者（订阅者）？什么是发布者？实现数据响应式的基本原理是什么？这样再去看 Vue 源码，就容易很多。

网上有人总结的很形象，这里借用下：

``` html
观察者模式（Observer）：通常又被称作为发布-订阅者模式。它定义了一种一对多的依赖关系，即当一个对象的状态发生改变的时候，所有依赖于它的对象都会得到通知并自动更新，解决了主体对象与观察者之间功能的耦合。

讲个故事

上面对于观察者模式的概念可能会比较官方化，所以我们讲个故事来理解它。

A：是共产党派往国民党密探，代号 001（发布者）

B：是共产党的通信人员，负责与 A 进行秘密交接（订阅者）

A 日常工作就是在明面采集国民党的一些情报

B 则负责暗中观察着 A

一旦 A 传递出一些有关国民党的消息（更多时候需要对消息进行封装传递，后面根据源码具体分析）

B 会立马订阅到该消息，然后做一些相对应的变更，比如说通知共产党们做一些事情应对国民党的一些动作。
```

这个比喻简单易懂，看完就明白了发布订阅的关系。发布订阅也是属于设计模式的一种，我们可以在网上查阅一些资料增加理解。它的应用也很广泛，比如 Vue 响应式原理、Vue 单一事件 $emit $on、Promise then 等等。

其实 Vue 做的就是这件事：系统初始化时收集对某个值的依赖（也可以说是观察者、订阅者），之所以能收集到依赖，是因为 Vue 通过 Object.deineProperty 拦截到了对某个对象某个字段的读取（访问）。当重置某个值的时候，触发之前收集的依赖回调函数更新，实现数据更新驱动视图变化。

我之前写了一个发布订阅类，可以作为参考和理解，源码地址：

https://github.com/zhaoyiming0803/test-code/blob/master/test47.js

在后面的笔记中，会详细介绍发布订阅模式在 Vue 中的应用，以及 Vue 收集依赖、触发依赖更新的详细过程。

### 注意
本文最后编辑于2019/05/12，技术更替飞快，文中部分内容可能已经过时，如有疑问，可在线提issue。



